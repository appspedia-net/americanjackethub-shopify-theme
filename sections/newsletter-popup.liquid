{{ 'popup.css' | asset_url | stylesheet_tag }}
{%- assign should_appear_popup = false -%}

{%- if 
  section.settings.show_only_on_index == false or
  section.settings.show_only_on_index and request.page_type == 'index'
-%}
  {%- assign should_appear_popup = true -%}
{%- endif -%}
<style>
  #newsletter-popup .modal__content-custom {
    width: calc(100% - 30px);
    max-width: {{ section.settings.width_popup }}px;
  }
</style>
{%- if should_appear_popup -%}
  <modal-content
    section="{{ section.id }}"
    {% if section.settings.show_only_once %}
      only-once
    {% endif %}
    apparition-delay="{{ section.settings.apparition_delay }}"
    id="newsletter-popup"
    class="modal position__popup-{{ section.settings.display_position }}"
  >
    <div class="modal__overlay"></div>
    <div class="modal__content-custom color-{{ section.settings.color_scheme }}">
      <button
        type="button"
        class="modal__close-button drawer__close tap-area"
        data-action="close"
        title="close"
      >
        {%- render 'icon' with 'close' -%}
      </button>

      <div class="newsletter-modal">
        {%- if  section.settings.show_image -%}
          {%- if section.settings.image != blank  -%}
            <div class="newsletter-modal__image">
              {{-
              section.settings.image
              | image_url: width: section.settings.image.width
              | image_tag:
                loading: 'lazy',
                sizes: '(max-width: 740px) 100vw, 500px',
                widths: '300,400,500,600,700,800,900,1000',
                class: 'newsletter-modal__image'
            -}}
            </div>
          {%- else -%}
          <div class="newsletter-modal__image no-image">
            {{ 'hero-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
          {%- endif -%}
        {%- endif -%}

        <div class="newsletter-modal__content {% if section.settings.image != blank %}newsletter-modal__content--extra{% endif %} center">
          {%- for block in section.blocks -%}
            <style>
              .block-{{  block.id }} {
                padding-bottom: {{ block.settings.padding_bottom_mb }}px;
              }
              @media screen and (min-width: 750px) {
                .block-{{  block.id }} {
                  padding-bottom: {{ block.settings.padding_bottom }}px;
                }
              }
            </style>
            <div class="block-{{ block.id }} block--{{ block.type }}">
              {%- case block.type -%}
                {%- when '@app' -%}
                  {% render block %}
                {%- when 'heading' -%}
                  <h2
                    class="inline-richtext heading{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                    {{ block.shopify_attributes }}
                    {% if settings.animations_reveal_on_scroll %}
                      data-cascade
                    {% endif %}
                    style="
                      {% if settings.animations_reveal_on_scroll %}
                        --animation-order: {{ forloop.index }};
                      {% endif %}
                      font-size: {{ block.settings.heading_size }}px;
                      --font-size-mb: {{block.settings.heading_size_mb}}px;
                    "
                  >
                    {{ block.settings.heading }}
                  </h2>
                {%- when 'subheading' -%}
                  <div
                    class="newsletter__subheading sub_heading rte{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                    {{ block.shopify_attributes }}
                    {% if settings.animations_reveal_on_scroll %}
                      data-cascade
                    {% endif %}
                    style="
                      {% if settings.animations_reveal_on_scroll %}
                        --animation-order: {{ forloop.index }};
                      {% endif %}
                      font-size: {{ block.settings.heading_size }}px;
                    "
                  >
                    {{ block.settings.text }}
                  </div>
                  {%- when 'logo' -%}
                    {%- if block.settings.image != blank -%}
                        {%- assign image_height = block.settings.logo_width
                          | divided_by: block.settings.image.aspect_ratio
                        -%}
                        <div
                          class="footer-block__image-wrapper"
                          style="max-width: min(100%, {{ block.settings.logo_width }}px); --margin: {{block.settings.logo_margin}}px; --margin-mb: {{block.settings.logo_margin_mb}}px"
                        >
                          <a href="{{ routes.root_url }}">
                          {{
                            block.settings.image
                            | image_url: width: 1100
                            | image_tag:
                              loading: 'lazy',
                              widths: '50, 100, 150, 200, 300, 400, 550, 800, 1100',
                              height: image_height,
                              width: block.settings.logo_width
                          }}
                          </a>
                        </div>
                    {%- endif -%}
                {%- when 'content' -%}
                    <div
                      class="rte{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                      {{ block.shopify_attributes }}
                      {% if settings.animations_reveal_on_scroll %}
                        data-cascade
                      {% endif %}
                      style="
                        {% if settings.animations_reveal_on_scroll %}
                          --animation-order: {{ forloop.index }};
                        {% endif %}
                        font-size: {{ block.settings.heading_size }}px;
                      "
                    >
                      {{ block.settings.text }}
                    </div>
                {%- when 'paragraph' -%}
                  <div
                    class="rte{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                    {{ block.shopify_attributes }}
                    {% if settings.animations_reveal_on_scroll %}
                      data-cascade
                    {% endif %}
                    style="
                      {% if settings.animations_reveal_on_scroll %}
                        --animation-order: {{ forloop.index }};
                      {% endif %}
                      font-size: {{ block.settings.heading_size }}px;
                    "
                  >
                    {{ block.settings.text }}
                  </div>
                {%- when 'email_form' -%}
                  <div {{ block.shopify_attributes }}>
                    {% form 'customer', class: 'newsletter-form' %}
                      <input type="hidden" name="contact[tags]" value="newsletter">
                      <div
                        class="newsletter-form__field-wrapper{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                        {% if settings.animations_reveal_on_scroll %}
                          data-cascade
                          style="--animation-order: {{ forloop.index }};"
                        {% endif %}
                      >
                        <div class="field">
                          <input
                            id="NewsletterForm--{{ section.id }}"
                            type="email"
                            name="contact[email]"
                            class="field__input"
                            value="{{ form.email }}"
                            aria-required="true"
                            autocorrect="off"
                            autocapitalize="off"
                            autocomplete="email"
                            {% if form.errors %}
                              autofocus
                              aria-invalid="true"
                              aria-describedby="Newsletter-error--{{ section.id }}"
                            {% elsif form.posted_successfully? %}
                              aria-describedby="Newsletter-success--{{ section.id }}"
                            {% endif %}
                            placeholder="{{ 'newsletter.label' | t }}"
                            required
                          >
                          <label class="field__label" for="NewsletterForm--{{ section.id }}" hidden>
                            {{ 'newsletter.label' | t }}
                          </label>
                          <button
                            type="submit"
                            class="button"
                            name="commit"
                            id="Subscribe"
                            aria-label="{{ 'newsletter.button_label_2' | t }}"
                          >
                            {{ 'newsletter.button_label_2' | t }}
                          </button>
                        </div>
                        {%- if form.errors -%}
                          <small class="newsletter-form__message form__message" id="Newsletter-error--{{ section.id }}">
                            {%- render 'icon-error' -%}
                            {{- form.errors.translated_fields.email | capitalize }}
                            {{ form.errors.messages.email -}}
                          </small>
                        {%- endif -%}
                      </div>
                      {%- if form.posted_successfully? -%}
                        <h3
                          class="newsletter-form__message newsletter-form__message--success form__message"
                          id="Newsletter-success--{{ section.id }}"
                          tabindex="-1"
                          autofocus
                        >
                          {% render 'icon-success' -%}
                          {{- 'newsletter.success' | t }}
                        </h3>
                      {%- endif -%}
                    {% endform %}
                  </div>
                {%- when 'button' -%}
                  <div
                    class="newsletter__button--block {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                    {{ block.shopify_attributes }}
                    {% if settings.animations_reveal_on_scroll %}
                      data-cascade
                      style="--animation-order: {{ forloop.index }};"
                    {% endif %}
                  >
                    <div class="d-flex a-i--center">
                      {%- if block.settings.text != blank -%}
                        <a href="{{ block.settings.link }}" class="button">
                          {{ block.settings.text }}
                        </a>
                      {%- endif -%}
                    </div>
                  </div>
              {%- endcase -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    </div>
  </modal-content>
{%- endif -%}

{% schema %}
{
  "name": "Popup Newsletter",
  "class": "shopify-section--popup",
  "settings": [
    {
      "type": "paragraph",
      "content": "Customers who subscribe will have their email address added to the \"accepts marketing\" [customer list](/admin/customers?query=&accepts_marketing=1)."
    },
    {
      "type": "range",
      "id": "width_popup",
      "label": "Width popup",
      "min": 100,
      "max": 1000,
      "step": 10,
      "default": 540
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "info": "t:sections.all.colors.has_cards_info",
      "default": "background-1"
    },
    {
      "type": "range",
      "id": "apparition_delay",
      "min": 0,
      "max": 15,
      "step": 1,
      "unit": "sec",
      "label": "Delay until the popup appears",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_only_on_index",
      "label": "Show only on home page",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_only_once",
      "label": "Show once to visitors",
      "default": true
    },
    {
      "type": "select",
      "id": "display_position",
      "label": "Display position",
      "options": [
        {
          "value": "middle-center",
          "label": "Middle center"
        },
        {
          "value": "bottom-left",
          "label": "Bottom left"
        },
        {
          "value": "bottom-right",
          "label": "Bottom right"
        }        
      ],
      "default": "middle-center"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Show image",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    }
  ],
  "blocks": [
    {
      "type": "heading",
      "name": "t:sections.newsletter.blocks.heading.name",
      "limit": 1,
      "settings": [
        {
          "type": "textarea",
          "id": "heading",
          "default": "<p>Heading</p>",
          "label": "t:sections.newsletter.blocks.heading.settings.heading.label"
        },
        {
          "type": "range",
          "id": "heading_size",
          "label": "Font size heading",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 28,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "heading_size_mb",
          "label": "Font size heading mobile",
          "min": 10,
          "max": 50,
          "step": 1,
          "default": 28,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    },
    {
      "type": "logo",
      "name": "Logo",
      "limit": 3,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Logo"
        },
        {
          "type": "range",
          "id": "logo_width",
          "label": "Logo width",
          "min": 20,
          "max": 200,
          "step": 5,
          "default": 115
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    },
    {
      "type": "paragraph",
      "limit": 3,
      "name": "text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Be the first to know about new collections and exclusive offers.</p>",
          "label": "t:sections.newsletter.blocks.paragraph.settings.paragraph.label"
        },
        {
          "type": "range",
          "id": "heading_size",
          "label": "Font size",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 14,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    },
    {
      "type": "subheading",
      "limit": 3,
      "name": "Sub heading",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Sub heading</p>",
          "label": "t:sections.newsletter.blocks.paragraph.settings.paragraph.label"
        },
        {
          "type": "range",
          "id": "heading_size",
          "label": "Font size",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 14,
          "unit": "px"
        },
        
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    },
    {
      "type": "content",
      "limit": 3,
      "name": "Content",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Content"
        },
        {
          "type": "range",
          "id": "heading_size",
          "label": "Font size",
          "min": 10,
          "max": 100,
          "step": 1,
          "default": 14,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    },
    {
      "type": "email_form",
      "name": "t:sections.newsletter.blocks.email_form.name",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "padding_bottom",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "t:sections.all.padding.padding_bottom",
          "default": 10
        },
        {
          "type": "range",
          "id": "padding_bottom_mb",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Padding bottom on Mobile",
          "default": 10
        }
      ]
    }
  ]
}
{% endschema %}
