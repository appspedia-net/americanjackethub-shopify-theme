{% comment %}
  Renders a megamenu for the header.

  Usage:
  {% render 'header-mega-menu' %}
{% endcomment %}

<nav class="header__inline-menu hidden-mb">
   
  <div class="page-width nav-header logo-postion__{{logo_postion}} {% if section.settings.menu == blank %} j-c--space{% endif %}">
    
    {% if menu_vertical.size > 0 and menu_vertical[0].settings.layout_menu == 'layout_1' %}
      {%- render 'menu-vertical', 
        menu_vertical: menu_vertical[0], 
        menu_style: menu_vertical[0].settings.layout_menu,
        show_icon: true,
        type: 'link'
      -%}
    {% endif %}
    {%- if section.settings.menu != blank and section.settings.menu_type_desktop != 'drawer' -%}
    <ul class="list-menu list-menu--inline" role="list">
      {%- for link in section.settings.menu.links -%}
        {%- liquid
          assign has_mega = false
          for block in section.blocks
            unless block.type contains 'mega_categories'
              if block.settings.title == link.title
                assign has_mega = true
                assign menu_type = block.type
                assign column_block = block.settings.number_colum
                assign image = block.settings.banner
                assign image_url = block.settings.image_url
                assign enable_custom_width = block.settings.enable_custom_width
                assign width_column = block.settings.width_column
                assign enable_banner = block.settings.enable_banner
                assign mega_block = block
                assign enable_custom_link = block.settings.enable_custom_link

                break
              endif
            endunless
          endfor
        -%}
        <li>
          {%- if link.links != blank -%}
            {%- if has_mega and menu_type_desktop == 'mega' -%}
              {%- render 'mega-menu', 
                index: forloop.index,
                mega_block: mega_block,
                menu_type: menu_type,
                link: link,
                image: image,
                image_url: image_url,
                show_arrow: show_arrow,
                column_block: column_block,
                enable_custom_width: enable_custom_width,
                width_column: width_column,
                enable_banner: enable_banner,
                enable_custom_link: enable_custom_link
              -%}
            {%- else -%}
              <div class="header-menu">
                <div id="Details-HeaderMenu-{{ forloop.index }}" class="header-menu__detail dropdown--menu">
                  <summary
                    id="HeaderMenu-{{ link.handle }}"
                    class="header__menu-item list-menu__item link link-underline focus-inset"
                  >
                    <span
                      {%- if link.child_active %}
                        class="header__active-menu-item"
                      {% endif %}
                    >
                      {{- link.title | escape -}}
                    </span>
                    {%- if show_arrow -%}
                      {%- render 'icon' with 'caret-down' -%}
                    {%- endif -%}
                  </summary>
                  <ul
                    id="HeaderMenu-MenuList-{{ forloop.index }}"
                    class="header__submenu list-menu list-menu--disclosure color-{{ section.settings.menu_color_scheme }} gradient caption-large motion-reduce global-settings-popup menuList-lv_2"
                    role="list"
                    tabindex="-1"
                  >
                    {%- for childlink in link.links -%}
                      <li>
                        {%- if childlink.links == blank -%}
                          <a
                            id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}"
                            href="{{ childlink.url }}"
                            class="header__menu-item list-menu__item link link-underline link--text focus-inset caption-large{% if childlink.current %} list-menu__item--active{% endif %}"
                            {% if childlink.current %}
                              aria-current="page"
                            {% endif %}
                          >
                            {{ childlink.title | escape }}
                          </a>
                        {%- else -%}
                          <div id="Details-HeaderSubMenu-{{ link.handle }}-{{ childlink.handle }}" class="header-menu__detail dropdown--menu">
                            <summary
                              id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}"
                              class="header__menu-item link link--text link-underline list-menu__item focus-inset caption-large"
                            >
                              <span>{{ childlink.title | escape }}</span>
                              {% render 'icon-caret' %}
                            </summary>
                            <ul
                              id="HeaderMenu-SubMenuList-{{ link.handle }}-{{ childlink.handle }}-{{ grandchildlink.handle }}"
                              class="header__submenu list-menu motion-reduce menuList-lv_3 global-settings-popup"
                            >
                              {%- for grandchildlink in childlink.links -%}
                                <li>
                                  <a
                                    id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}-{{ grandchildlink.handle }}"
                                    href="{{ grandchildlink.url }}"
                                    class="header__menu-item list-menu__item link link-underline link--text focus-inset caption-large{% if grandchildlink.current %} list-menu__item--active{% endif %}"
                                    {% if grandchildlink.current %}
                                      aria-current="page"
                                    {% endif %}
                                  >
                                    {{ grandchildlink.title | escape }}
                                  </a>
                                </li>
                              {%- endfor -%}
                            </ul>
                          </div>
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              </div>
            {%- endif -%}
          {%- else -%}
            <a
              id="HeaderMenu-{{ link.handle }}"
              href="{{ link.url }}"
              class="header__menu-item list-menu__item link-underline link link--text focus-inset"
              {% if link.current %}
                aria-current="page"
              {% endif %}
            >
              <span
                {%- if link.current %}
                  class="header__active-menu-item"
                {% endif %}
              >
                {{- link.title | escape -}}
              </span>
            </a>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>
    {%- endif -%}
    <div class="nav-header__logo">
      {%- if request.page_type == 'index' -%}
        <h1 class="header__heading">
      {%- endif -%}
          <a href="{{ routes.root_url }}" class="header__heading-link link link--text focus-inset header__heading">
          {%- if section.settings.logo_type == 'image' -%}
              {%- if section.settings.logo_image != blank -%}
                  <div class="header__heading-logo-wrapper">
                      {%- assign logo_alt = section.settings.logo_image.alt | default: shop.name | escape -%}
                      {%- assign logo_height = section.settings.logo_width | divided_by: section.settings.logo_image.aspect_ratio -%}
                      {% capture sizes %}(min-width: 750px) {{ section.settings.logo_width }}px, 50vw{% endcapture %}
                      {% capture widths %}{{ section.settings.logo_width }}, {{ section.settings.logo_width | times: 1.5 | round }}, {{ section.settings.logo_width | times: 2 }}{% endcapture %}
                      {{ section.settings.logo_image | image_url: width: 600 | image_tag:
                          class: 'header__heading-logo motion-reduce',
                          widths: widths,
                          height: logo_height,
                          width: section.settings.logo_width,
                          alt: logo_alt,
                          sizes: sizes,
                          preload: true
                      }}
                  </div>
              {%- else -%}
                  <span class="h2">{{ shop.name }}</span>
              {%- endif -%}
          {%- else -%}
              {%- if section.settings.logo_text != blank -%}
                  <div class="header__heading-logo-wrapper logo_text">
                      {{ section.settings.logo_text }}
                      </div>
              {%- else -%}
                  <span class="h2">{{ shop.name }}</span>
              {%- endif -%}
          {%- endif -%}
          </a>
      {%- if request.page_type == 'index' -%}
          </h1>
      {%- endif -%}
    </div>
    <div class="header__icons">
      {% render 'header-search', input_id: 'Search-In-Modal' %}
     
      {%- if shop.customer_accounts_enabled and section.settings.enable_account -%}
        <a href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}" class="header__icon header__icon--account link focus-inset{% if section.settings.hidden_account_mb != blank %} small-hide{% endif %} header__icon-show--{{ section.settings.account_with }}" data-drawer-login>
          {%- render 'icon' with 'account' -%}
          <span class="header__icon-text">
            {%- liquid
              if customer
              echo 'customer.account_fallback' | t
            else
              echo 'customer.account.title_header' | t
            endif
          -%}
        </span>
        <span class="visually-hidden">
          {%- liquid
            if customer
              echo 'customer.account_fallback' | t
            else
              echo 'customer.log_in' | t
            endif
          -%}
        </span>
        </a>
      {%- endif -%} 

      {%- if section.settings.enable_wishlist -%}
        <a href="{{ settings.link_wishlist }}" class="header__icon header__icon--wishlist link focus-inset{% if section.settings.hidden_account_mb != blank %} small-hide{% endif %} header__icon-show--{{ section.settings.wishlist_with }}">
          {% render 'icon' with 'wishlist' %}
          <span class="header__icon-text">
            {{ 'templates.wishlist.header' | t }}
          </span>
          <span class="visually-hidden">{{ 'templates.wishlist.header' | t }}</span>
          <div class="wishlist-count-bubble">
            <span id="wishlist-count">0</span>
          </div>
        </a>
      {%- endif -%}
      {%- if section.settings.enable_cart -%}
        <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset{% if section.settings.hidden_account_mb != blank %} small-hide{% endif %} header__icon-show--{{ section.settings.cart_with }}" id="cart-icon-bubble">
          {% render 'icon' with 'cart' %}
          <span class="header__icon-text">
            {{ 'templates.cart.cart' | t }}
          </span>
          <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
          <div class="cart-count-bubble">
            <span aria-hidden="true">{{ cart.item_count }}</span>
            <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
          </div>
        </a>
      {%- endif -%}
    </div>
  </div>
</nav>
