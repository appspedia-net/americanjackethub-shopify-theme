{%- liquid
  assign total_width = 100
  if width_banner > 0 and width_column > 0
    assign total_width = width_banner | plus: width_column
  endif
-%}
<details-menu class="header-menu" style="--width-block: {{ width_column }}px">
  <div id="Details-HeaderMenu-{{ index }}" class="mega-menu {{ menu_type }} dropdown--menu{% if enable_custom_width %} menu-relative{% endif %}">
    <summary
      id="HeaderMenu-{{ link.handle }}"
      class="header__menu-item list-menu__item link focus-inset"
    >
      <span
        {%- if link.child_active %}
          class="header__active-menu-item"
        {% endif %}
      >
        {{- link.title | escape -}}
      </span>
      {%- if show_arrow -%}
        {%- render 'icon' with 'caret-down' -%}
      {%- endif -%}
    </summary>
    <div
      id="MegaMenu-Content-{{ index }}"
      class="mega-menu__content color-{{ section.settings.menu_color_scheme }} gradient motion-reduce global-settings-popup"
      tabindex="-1"
    >
      <div class="mega__flex{% if total_width > 100 %} flex-wrap{% endif %}{% if enable_custom_width == false %} page-width{% endif %} {% if enable_banner and mega_block.settings.banner != blank %}has-banner {% endif %}">
        <ul
          class="mega-menu__list{% if link.levels == 1 %} mega-menu__list--condensed{% endif %}"
          role="list"
          style="--column-block: {{ column_block }};"
        >
          {%- for childlink in link.links -%}
            <li>
              <a
                id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}"
                href="{{ childlink.url }}"
                class="mega-menu__link link-underline mega-menu__link--level-{% if childlink.links != blank %}2{% else %}3{% endif %} link{% if childlink.current %} mega-menu__link--active{% endif %}"
                {% if childlink.current %}
                  aria-current="page"
                {% endif %}
              >
                {{ childlink.title | escape }}
              </a>
              {%- if childlink.links != blank -%}
                <ul class="list-unstyled" role="list">
                  {%- for grandchildlink in childlink.links -%}
                    <li>
                      <a
                        id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}-{{ grandchildlink.handle }}"
                        href="{{ grandchildlink.url }}"
                        class="mega-menu__link link mega-menu__link--level-3 link-underline {% if grandchildlink.current %} mega-menu__link--active{% endif %}"
                        {% if grandchildlink.current %}
                          aria-current="page"
                        {% endif %}
                      >
                        {{ grandchildlink.title | escape }}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              {%- endif -%}
            </li>
          {%- endfor -%}
        </ul>
        {%- if enable_banner and mega_block.settings.banner != blank -%}
          <div class="mega_banner">
            <a href="{{ mega_block.settings.banner_link }}">
              {{
                mega_block.settings.banner
                | image_url: width:  mega_block.settings.banner.width
                | image_tag:
                  widths: '50, 75, 100, 150, 200, 300, 400, 500, 750, 1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000, 3200',
                  sizes: full_width,
                  class: 'mega_banner--image',
                  alt:  mega_block.settings.banner.alt
              }}
            </a>
          </div>
        {%- endif -%}
      </div>

      {%- if enable_custom_link -%}
          <div class="mega-custom_links page-width">
            <ul class="links">
              {%- for info in (1..8) -%}
              {%- capture banner_image -%}collection_image_{{ forloop.index }}{%- endcapture -%}
              {%- capture link -%}link_{{ forloop.index }}{%- endcapture -%}
              {%- capture link_title -%}link_title_{{ forloop.index }}{%- endcapture -%}
          
              {%- if mega_block.settings[banner_image] != blank or mega_block.settings[link_title] != blank -%}
                <li class="link-item">
                  <div class="card-wrapper">
                    {%- if mega_block.settings[banner_image] != blank -%}
                      <div class="card__banner">
                         <a href="{{ mega_block.settings[link] }}">
                          {{
                            mega_block.settings[banner_image]
                            | image_url: width: 100
                            | image_tag:
                              widths: '50, 75, 100, 150, 200, 300, 400, 500, 750, 1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000, 3200',
                              sizes: full_width,
                              class: 'mega_banner--link',
                              alt:  mega_block.settings[banner_image].alt
                          }}
                          </a>
                      </div>
                      {%- endif -%}
                    {%- if mega_block.settings[link_title] != blank -%}
                      <h3 class="card__heading">
                        <a href="{{ mega_block.settings[link] }}" class="full-unstyled-link link-decoration center">
                          <span>{{ mega_block.settings[link_title] }}</span>
                        </a>
                      </h3>
                    {%- endif -%}
                  </div>
                </li>
              {%- endif -%}
            {%- endfor -%}
            </ul>
          </div>
      {%- endif -%}
    </div>
  </div>
</details-menu>
